<!DOCTYPE html>
<html lang="en">
<head>
    <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>gridstack-angular demo</title>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <link rel="stylesheet" href="bower_components/gridstack/dist/gridstack.css"/>
    <link rel="stylesheet" href="gridstack-extra.css"/>


    <style type="text/css">
        #belt-grid {
            margin-top: 30px;
            background-image: linear-gradient(to right, grey 1px, transparent 1px),
                linear-gradient(to bottom, grey 1px, transparent 1px);
        }
        .grid-stack-item-content {
            color: #2c3e50;
            text-align: center;
            background: #33c6ff;
        }

        .grid-stack-item-content p {
            font-weight: bold;
            line-height: 1.1em;
            margin: 5px;
        }

        .grid-stack-item-content p.dimensions {
            margin: 15px 0;
        }

    </style>
</head>
<body ng-app="GridStack" ng-controller="DemoCtrl" ng-init="init()">
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-1">
                <p>Scale</p>
                <p>1' x 1.00"</p>
                <hr />
                <button type="button" class="btn btn-primary" ng-click="addWidget()">Add Cut</button>
                <button type="button" class="btn" ng-click="changeZoom(1)"> Zoom In </button>
                <button type="button" class="btn" ng-click="changeZoom(-1)"> Zoom Out </button>
            </div>
    
            <div class="col-md-11">
                <div id="info-general">
                    <p>SIZE: {{beltLength}}' X {{beltWidth | number : 4}}" ITEM: {{itemID}} BELT LOT: {{lot}} CUST: {{customerName}}</p>
                    <p>REQUIRED: 2 CUTS - 80'6.0000" X 36.0000 ****1 OF 2 ADDED ****</p>
                </div>
                <div id="belt-grid">
                    <div class='ruler-horizontal'></div>
                    <div gridstack class="grid-stack" options="options" on-resize-stop="onResizeStop(event,ui)">
                        <div class='ruler-vertical'></div>
                        <div gridstack-item ng-repeat="w in widgets" ng-switch="w.Status" class="grid-stack-item" data-id={{w.Id}} gs-item-x="w.X" gs-item-y="w.Y"
                            gs-item-width="w.Width" gs-item-height="w.Length" gs-item-autopos="w.AutoPos" on-item-added="onItemAdded(item)">
                                <div ng-switch-when="0">
                                    <div class="grid-stack-item-content current" ng-mouseover="showTooltip($event)" ng-mouseout="hideTooltip($event)">
                                        <div class="tooltip">
                                            <p class="dimensions">{{w.Width | number : 4}}" x {{w.Length / 12 | number : 4}}'</p>
                                            <div ng-repeat="info in w.DisplayInfo">
                                                <p>{{info.Label}}: {{info.Value}}</p>
                                            </div>
                                        </div>
                                        <a ng-click="validateCreateOffcut(w)">Config</a>
                                        <p class="dimensions">{{w.Width | number : 4}} x {{w.Length / 12 | number : 4}}</p>
                                        <div ng-repeat="info in w.DisplayInfo">
                                            <p>{{info.Label}}: {{info.Value}}</p>
                                        </div>
                                        <a class="btn btn-primary offcutX" ng-click="offcutX(w)" >offcut x</a>
                                        <a class="btn btn-primary offcutY" ng-click="offcutY(w)" >offcut y</a>
                                        <a class="btn btn-primary" ng-click="removeWidget(w)" >remove</a>
                                    </div>
                                </div>
                                <div ng-switch-when="1">
                                    <div class="grid-stack-item-content cut" ng-mouseover="showTooltip($event)" ng-mouseout="hideTooltip($event)">
                                        <div class="tooltip">
                                            <p class="dimensions">{{w.Width | number : 4}}" x {{w.Length / 12 | number : 4}}'</p>
                                            <div ng-repeat="info in w.DisplayInfo">
                                                <p>{{info.Label}}: {{info.Value}}</p>
                                            </div>
                                        </div>
                                        <a ng-click="validateCreateOffcut(w)">Config</a>
                                        <p class="dimensions">{{w.Width | number : 4}} x {{w.Length / 12 | number : 4}}</p>
                                        <div ng-repeat="info in w.DisplayInfo">
                                            <p>{{info.Label}}: {{info.Value}}</p>
                                        </div>
                                        <a class="btn btn-primary offcutX" ng-click="offcutX(w)" >offcut x</a>
                                        <a class="btn btn-primary offcutY" ng-click="offcutY(w)" >offcut y</a>
                                        <a class="btn btn-primary" ng-click="removeWidget(w)" >remove</a>
                                    </div>
                                </div>
                                <div ng-switch-when="2">
                                    <div class="grid-stack-item-content not-cut" ng-mouseover="showTooltip($event)" ng-mouseout="hideTooltip($event)">
                                        <a ng-click="validateCreateOffcut(w)">Config</a>
                                        <p class="dimensions">{{w.Width | number : 4}} x {{w.Length / 12 | number : 4}}</p>
                                        <div ng-repeat="info in w.DisplayInfo">
                                            <p>{{info.Label}}: {{info.Value}}</p>
                                        </div>
                                        <a class="btn btn-primary offcutX" ng-click="offcutX(w)" >offcut x</a>
                                        <a class="btn btn-primary offcutY" ng-click="offcutY(w)" >offcut y</a>
                                        <a class="btn btn-primary" ng-click="removeWidget(w)" >remove</a>
                                    </div>
                                </div>
                                <div ng-switch-when="3">
                                    <div class="grid-stack-item-content another-lot" ng-mouseover="showTooltip($event)" ng-mouseout="hideTooltip($event)">
                                        <div class="tooltip">
                                            <p class="dimensions">{{w.Width | number : 4}}" x {{w.Length / 12 | number : 4}}'</p>
                                            <div ng-repeat="info in w.DisplayInfo">
                                                <p>{{info.Label}}: {{info.Value}}</p>
                                            </div>
                                        </div>
                                        <a ng-click="validateCreateOffcut(w)">Config</a>
                                        <p class="dimensions">{{w.Width | number : 4}} x {{w.Length / 12 | number : 4}}</p>
                                        <div ng-repeat="info in w.DisplayInfo">
                                            <p>{{info.Label}}: {{info.Value}}</p>
                                        </div>
                                        <a class="btn btn-primary offcutX" ng-click="offcutX(w)" >offcut x</a>
                                        <a class="btn btn-primary offcutY" ng-click="offcutY(w)" >offcut y</a>
                                        <a class="btn btn-primary" ng-click="removeWidget(w)" >remove</a>
                                    </div>
                                </div>
                                <div ng-switch-when="4">
                                    <div class="grid-stack-item-content deleted" ng-mouseover="showTooltip($event)" ng-mouseout="hideTooltip($event)">
                                        <a ng-click="validateCreateOffcut(w)">Config</a>
                                        <p class="dimensions">{{w.Width | number : 4}} x {{w.Length / 12 | number : 4}}</p>
                                        <div ng-repeat="info in w.DisplayInfo">
                                            <p>{{info.Label}}: {{info.Value}}</p>
                                        </div>
                                        <a class="btn btn-primary offcutX" ng-click="offcutX(w)" >offcut x</a>
                                        <a class="btn btn-primary offcutY" ng-click="offcutY(w)" >offcut y</a>
                                        <a class="btn btn-primary" ng-click="removeWidget(w)" >remove</a>
                                    </div>
                                </div>
                                <div ng-switch-when="5">
                                    <div class="grid-stack-item-content offcut" ng-mouseover="showTooltip($event)" ng-mouseout="hideTooltip($event)">
                                        <div class="tooltip">
                                            <p class="dimensions">{{w.Width | number : 4}}" x {{w.Length / 12 | number : 4}}'</p>
                                            <div ng-repeat="info in w.DisplayInfo">
                                                <p>{{info.Label}}: {{info.Value}}</p>
                                            </div>
                                        </div>
                                        <a ng-click="validateCreateOffcut(w)">Config</a>
                                        <p class="dimensions">{{w.Width | number : 4}} x {{w.Length / 12 | number : 4}}</p>
                                        <div ng-repeat="info in w.DisplayInfo">
                                            <p>{{info.Label}}: {{info.Value}}</p>
                                        </div>
                                        <a class="btn btn-primary offcutX" ng-click="offcutX(w)" >offcut x</a>
                                        <a class="btn btn-primary offcutY" ng-click="offcutY(w)" >offcut y</a>
                                        <a class="btn btn-primary" ng-click="removeWidget(w)" >remove</a>
                                    </div>
                                </div>
                                <div ng-switch-default>
                                    <div class="grid-stack-item-content other" ng-mouseover="showTooltip($event)" ng-mouseout="hideTooltip($event)">
                                        <a ng-click="validateCreateOffcut(w)">Config</a>
                                        <p class="dimensions">{{w.Width | number : 4}} x {{w.Length / 12 | number : 4}}</p>
                                        <div ng-repeat="info in w.DisplayInfo">
                                            <p>{{info.Label}}: {{info.Value}}</p>
                                        </div>
                                        <a class="btn btn-primary offcutX" ng-click="offcutX(w)" >offcut x</a>
                                        <a class="btn btn-primary offcutY" ng-click="offcutY(w)" >offcut y</a>
                                        <a class="btn btn-primary" ng-click="removeWidget(w)" >remove</a>
                                    </div>
                                </div>
                        </div>
                    </div>
                </div>
                <div>
                    <button class="btn-save" ng-click="buttonSaveData()">Save</button>
                </div>
            </div>
        </div>
    </div>

    <script src="bower_components/jquery/dist/jquery.min.js"></script>
    <script src="bower_components/jquery-ui/jquery-ui.js"></script>
    <script src="bower_components/lodash/dist/lodash.min.js"></script>
    <script src="bower_components/angular/angular.min.js"></script>
    <script src="bower_components/gridstack/dist/gridstack.js"></script>
    <script src="../src/gridstack.controller.js"></script>
    <script src="../src/gridstack.directive.js"></script>
    <script src="../src/gridstackitem.directive.js"></script>

    <script type="text/javascript">
        var app = angular.module('GridStack', ['gridstack-angular']).
          controller('DemoCtrl', function($scope, $log) {

            // var jsonData = {
            //     "ItemID": "TVVBELT",
            //     "ItemDesc": "TVV Belt Item",
            //     "Lot": "TVVLOT3-4-5",
            //     "BeltLength": "120.0000",
            //     "BeltWidth": "84.0000",
            //     "LotCost": "0.455789358",
            //     "RemnantLength": "5.000000000",
            //     "RemnantWidth": "5.000000000",
            //     "CustomerID": "0",
            //     "CustomerName": "",
            //     "CurrentTransType": "4",
            //     "CutLength": "0",
            //     "CutWidth": "0",
            //     "ExistingCuts": [
            //         {
            //             "Id": "178",
            //             "X": "0",
            //             "Y": "10",
            //             "Length": "100",
            //             "Width": "10",
            //             "Offcut": "",
            //             "ParentId": "",
            //             "Status": "3",
            //             "RowStatus": "0",
            //             "DisplayInfo": [
            //                 {
            //                     "Label": "Type",
            //                     "Value": "Inv Adjust"
            //                 },
            //                 {
            //                     "Label": "Adj #",
            //                     "Value": "104207"
            //                 },
            //                 {
            //                     "Label": "Adj Date",
            //                     "Value": "8/28/2017"
            //                 },
            //                 {
            //                     "Label": "Reason",
            //                     "Value": "NEW"
            //                 },
            //                 {
            //                     "Label": "Desc/New Lot",
            //                     "Value": "TVVLOT3-4-5"
            //                 }
            //             ]
            //         },
            //         {
            //             "Id": "180",
            //             "X": "10",
            //             "Y": "10",
            //             "Length": "100",
            //             "Width": "10",
            //             "Offcut": "",
            //             "ParentId": "",
            //             "Status": "3",
            //             "RowStatus": "0",
            //             "DisplayInfo": [
            //                 {
            //                     "Label": "Type",
            //                     "Value": "Inv Adjust"
            //                 },
            //                 {
            //                     "Label": "Adj #",
            //                     "Value": "104209"
            //                 },
            //                 {
            //                     "Label": "Adj Date",
            //                     "Value": "8/28/2017"
            //                 },
            //                 {
            //                     "Label": "Reason",
            //                     "Value": "NEW"
            //                 },
            //                 {
            //                     "Label": "Desc/New Lot",
            //                     "Value": "TVVLOT3-4-5"
            //                 }
            //             ]
            //         },
            //         {
            //             "Id": "177",
            //             "X": "0",
            //             "Y": "0",
            //             "Length": "10",
            //             "Width": "10",
            //             "Offcut": "",
            //             "ParentId": "",
            //             "Status": "1",
            //             "RowStatus": "0",
            //             "DisplayInfo": [
            //                 {
            //                     "Label": "Type",
            //                     "Value": "Prod Order"
            //                 },
            //                 {
            //                     "Label": "Prod Ord #",
            //                     "Value": "10001390"
            //                 },
            //                 {
            //                     "Label": "Order #",
            //                     "Value": "1927822"
            //                 },
            //                 {
            //                     "Label": "Order Date",
            //                     "Value": "8/28/2017"
            //                 },
            //                 {
            //                     "Label": "Cust ID",
            //                     "Value": "1006739"
            //                 },
            //                 {
            //                     "Label": "Cust",
            //                     "Value": "TVV Customer"
            //                 }
            //             ]
            //         },
            //         {
            //             "Id": "179",
            //             "X": "10",
            //             "Y": "0",
            //             "Length": "10",
            //             "Width": "10",
            //             "Offcut": "",
            //             "ParentId": "",
            //             "Status": "1",
            //             "RowStatus": "0",
            //             "DisplayInfo": [
            //                 {
            //                     "Label": "Type",
            //                     "Value": "Prod Order"
            //                 },
            //                 {
            //                     "Label": "Prod Ord #",
            //                     "Value": "10001391"
            //                 },
            //                 {
            //                     "Label": "Order #",
            //                     "Value": "1927823"
            //                 },
            //                 {
            //                     "Label": "Order Date",
            //                     "Value": "8/28/2017"
            //                 },
            //                 {
            //                     "Label": "Cust ID",
            //                     "Value": "1006739"
            //                 },
            //                 {
            //                     "Label": "Cust",
            //                     "Value": "TVV Customer"
            //                 }
            //             ]
            //         },
            //         {
            //             "Id": "186",
            //             "X": "20",
            //             "Y": "20",
            //             "Length": "15",
            //             "Width": "20",
            //             "Offcut": "",
            //             "ParentId": "",
            //             "Status": "2",
            //             "RowStatus": "0",
            //             "DisplayInfo": [
            //                 {
            //                     "Label": "Type",
            //                     "Value": "Prod Order"
            //                 },
            //                 {
            //                     "Label": "Prod Ord #",
            //                     "Value": "10001397"
            //                 },
            //                 {
            //                     "Label": "Order #",
            //                     "Value": "1928979"
            //                 },
            //                 {
            //                     "Label": "Order Date",
            //                     "Value": "6/29/2018"
            //                 },
            //                 {
            //                     "Label": "Cust ID",
            //                     "Value": "1006739"
            //                 },
            //                 {
            //                     "Label": "Cust",
            //                     "Value": "TVV Customer"
            //                 }
            //             ]
            //         },
            //         {
            //             "Id": "187",
            //             "X": "20",
            //             "Y": "35",
            //             "Length": "75",
            //             "Width": "20",
            //             "Offcut": "Y",
            //             "ParentId": "186",
            //             "Status": "6",
            //             "RowStatus": "0",
            //             "DisplayInfo": [
            //                 {
            //                     "Label": "Type",
            //                     "Value": "Prod Order"
            //                 },
            //                 {
            //                     "Label": "Prod Ord #",
            //                     "Value": "10001397"
            //                 },
            //                 {
            //                     "Label": "Order #",
            //                     "Value": "1928979"
            //                 },
            //                 {
            //                     "Label": "Order Date",
            //                     "Value": "6/29/2018"
            //                 },
            //                 {
            //                     "Label": "Cust ID",
            //                     "Value": "1006739"
            //                 },
            //                 {
            //                     "Label": "Cust",
            //                     "Value": "TVV Customer"
            //                 }
            //             ]
            //         },
            //         {
            //             "Id": "185",
            //             "X": "20",
            //             "Y": "0",
            //             "Length": "20",
            //             "Width": "10",
            //             "Offcut": "",
            //             "ParentId": "",
            //             "Status": "2",
            //             "RowStatus": "0",
            //             "DisplayInfo": [
            //                 {
            //                     "Label": "Type",
            //                     "Value": "Prod Order"
            //                 },
            //                 {
            //                     "Label": "Prod Ord #",
            //                     "Value": "10001396"
            //                 },
            //                 {
            //                     "Label": "Order #",
            //                     "Value": "1928931"
            //                 },
            //                 {
            //                     "Label": "Order Date",
            //                     "Value": "6/12/2018"
            //                 },
            //                 {
            //                     "Label": "Cust ID",
            //                     "Value": "1006739"
            //                 },
            //                 {
            //                     "Label": "Cust",
            //                     "Value": "TVV Customer"
            //                 }
            //             ]
            //         }
            //     ],
            //     "CurrentCuts": []
            // };

            var jsonData = {"ItemID":"BELT TEST","ItemDesc":"60in Belting Material Test","Lot":"12345","BeltLength":"12000.0000","BeltWidth":"60.0000","LotCost":"0","RemnantLength":"0","RemnantWidth":"0","CustomerID":"0","CustomerName":"","CurrentTransType":"0","CutLength":"0","CutWidth":"0","ExistingCuts":[{"Id":"2","X":"0","Y":"0","Length":"2400","Width":"30","Offcut":"","ParentId":"","Status":"1","RowStatus":"0","DisplayInfo":[{"Label":"Type","Value":"Order"},{"Label":"Order #","Value":"1000020"},{"Label":"Order Date","Value":"2019-02-04"},{"Label":"Cust ID","Value":"10014"},{"Label":"Cust","Value":"Cameron"}]},{"Id":"3","X":"30","Y":"0","Length":"2400","Width":"30","Offcut":"","ParentId":"","Status":"6","RowStatus":"0","DisplayInfo":[{"Label":"Type","Value":"Order"},{"Label":"Order #","Value":"1000020"},{"Label":"Order Date","Value":"2019-02-04"},{"Label":"Cust ID","Value":"10014"},{"Label":"Cust","Value":"Cameron"}]},{"Id":"4","X":"0","Y":"2400","Length":"1200","Width":"30","Offcut":"","ParentId":"","Status":"1","RowStatus":"0","DisplayInfo":[{"Label":"Type","Value":"Order"},{"Label":"Order #","Value":"1000020"},{"Label":"Order Date","Value":"2019-02-04"},{"Label":"Cust ID","Value":"10014"},{"Label":"Cust","Value":"Cameron"}]},{"Id":"5","X":"30","Y":"2400","Length":"600","Width":"30","Offcut":"","ParentId":"","Status":"1","RowStatus":"0","DisplayInfo":[{"Label":"Type","Value":"Order"},{"Label":"Order #","Value":"1000020"},{"Label":"Order Date","Value":"2019-02-04"},{"Label":"Cust ID","Value":"10014"},{"Label":"Cust","Value":"Cameron"}]}],"CurrentCuts":[]}

            $scope.beltLength = jsonData.BeltLength / 12;
            $scope.beltWidth = jsonData.BeltWidth;
            $scope.widgets = jsonData.ExistingCuts;
            $scope.zoom = 10;
            jsonData.CurrentCuts = [];

            $scope.options = {
                width: $scope.beltWidth,
                cellHeight: 1.66666667, // 20px / 12 (IN to FT)
                verticalMargin: 0
            };

            function saveData(item) {
                //jsonData.CurrentCuts.push(item);
                //windowService.changeData($scope, '_dw_belt_info_json.belt_info_json', JSON.stringify(jsonData));
            }

            function addWidget (width, length) {
                // AutoPositioning value must be declared because loaded values don't need autopositioning,
                // but that variable needs to be erased before calling changeData. Only gridstack needs it
                var newWidget = { Width: width, Length: length, Offcut: '', ParentId: '', Status: 6, RowStatus: '0', DisplayInfo: '', AutoPos: 1 };
                $scope.widgets.push(newWidget);
            }

            $scope.removeWidget = function(w) {
                var index = $scope.widgets.indexOf(w);
                $scope.widgets.splice(index, 1);

                var removedCut = {Id: w.Id, X: w.X, Y: w.Y, Width: w.Width, Length: w.Length, Offcut: w.Offcut,
                    ParentId: w.ParentId, Status: w.Status, RowStatus: w.RowStatus, DisplayInfo: w.DisplayInfo };

                //add to currentCuts
                saveData(removedCut);
            };

            function getItemById (id) {
                return jsonData.ExistingCuts.filter(
                    function(data) {
                        return data.Id == id;
                    }
                );
            }

            $scope.onResizeStop = function(event, ui) {
                var element = event.target;
                var id = angular.element(element).attr('data-id');
                var item = getItemById(id);

                // get item and update current cuts
                saveData(item);
            };

            $scope.onItemAdded = function(item) {
                // Add cuts created in the UI to the belt-grid variable
                if (item.autoPosition) {
                    var newCut = { X: item.x, Y: item.y, Width: item.width, Length: item.height, Offcut: '',
                        ParentId: '', Status: '', RowStatus: '', DisplayInfo: '' };

                    saveData(newCut);
                }

                // Figure out how to lock the created item
                angular.element('.grid-stack').each(function (idx, gsEl) {
                    angular.element(gsEl).data('gridstack').locked('.grid-stack-item', true);
                });
            };

            $scope.offcutX = function (w) {
                var posX = w.X + w.Width;
                var offcutWidth = $scope.beltWidth - w.Width;

                // TODO: ADD ID
                var newOffcut = { X: posX, Y: w.Y, Width: offcutWidth, Length:w.Length, Offcut: 'Y',
                    ParentId: w.Id, Status: 5, RowStatus: w.RowStatus, DisplayInfo: w.DisplayInfo};
                $scope.widgets.push(newOffcut);

                //add to currentCuts
                saveData(newOffcut);
            };

            $scope.offcutY = function (w) {
                var posY = w.Y + w.Length;
                var offcutLength = ($scope.beltLength * 12) - w.Length;

                // TODO: ADD ID
                var newOffcut = { X: w.X, Y:posY, Width: w.Width, Length: offcutLength, Offcut: 'Y',
                    ParentId: w.Id, Status: 5, RowStatus: w.RowStatus, DisplayInfo: w.DisplayInfo};
                $scope.widgets.push(newOffcut);

                //add to currentCuts
                saveData(newOffcut);
            };

            $scope.validateCreateOffcut = function (currentCut) {
                var cutNextToXPos = false;
                var cutNextToYPos = false;
                var edgeOfGrid = false;
                var endOfGridY = false;

                console.log(currentCut);

                $('.grid-stack-item').each(function (idx, gsEl) {
                    var elementData = gsEl.dataset;
                    if (currentCut.Id != elementData.id) {
                        // if grid has no empty space horizontally
                        if ((currentCut.Y + currentCut.Length - 1 > elementData.gsY && currentCut.Y < elementData.gsY + elementData.gsWidth)) {
                            cutNextToXPos = true;
                        }
                        // if grid has no empty space vertically
                        if (currentCut.X < elementData.gsX + elementData.gsWidth &&
                                currentCut.X + currentCut.Width > elementData.gsX &&
                                currentCut.Y < elementData.gsY) {
                            //console.log("X:" + currentCut.X + " Y:" + currentCut.Y + " Width:" + currentCut.Width + " Length: " + currentCut.Length);
                            //console.log("gsX:" + elementData.gsX + " gsY:" + elementData.gsY + " gsWidth:" + elementData.gsWidth);
                            //console.log(elementData.gsWidth);
                            cutNextToYPos = true;
                        }
                    }
                });

                // if the cut is on the edge of the grid
                if (currentCut.X == 0 || currentCut.X + currentCut.Width == $scope.beltWidth) {
                    edgeOfGrid = true;
                }

                // if the cut is at the end of the grid vertically
                if (currentCut.Y + currentCut.Length == $scope.Length) {
                    endOfGridY = true;
                }

                if (!cutNextToXPos && edgeOfGrid) {
                    //currentCut.classList.add('offcutX');
                    console.log("Can create offcut X");
                }
                else {
                    //currentCut.classList.remove('offcutX');
                }

                 // show vertical offcut option for idLastY
                if (!cutNextToYPos && !endOfGridY ) {
                    //currentCut.classList.add('offcutY');
                    console.log("Can create offcut Y ");
                }
                else {
                    //currentCut.classList.remove('offcutY');
                }
            }

            function deserializeData() {
                // Belting grid data
                $scope.itemID = jsonData.ItemID;
                $scope.itemDesc = jsonData.ItemDesc;
                $scope.lot = jsonData.Lot;
                $scope.lotCost = jsonData.LotCost;
                $scope.customerName = jsonData.CustomerName;
            }

            function createRulerDimensions() {
                var numItemsHorizontal = $scope.beltWidth / 12;
                var numItemsVertical = $scope.beltLength / 20;
                //var scaleWidthToHeight = 1;

                var rulerHorizontal = document.querySelector('.ruler-horizontal');
                var rulerVertical = document.querySelector('.ruler-vertical');
                var i = 0;

                rulerVertical.style.height = ($scope.beltLength * 20) + 'px';

                for (i = 0; i <= numItemsHorizontal; i++) {
                    var element = document.createElement('div');
                    element.className = 'in';
                    element.dataset.text = (i * 12) + '.0"';
                    rulerHorizontal.appendChild(element);
                }

                for (i = 0; i <= numItemsVertical; i++) {
                    var element = document.createElement('div');
                    element.className = 'in';
                    element.dataset.text = (i * 20) + '.0\'';
                    rulerVertical.appendChild(element);
                }
            }

            function createGridStyles() {
                var grid = document.querySelector('#belt-grid');
                grid.style.height = ($scope.beltLength * 20) + 'px';
                grid.style.backgroundSize = (100 / $scope.beltWidth) + '% ' + '20px';
            }

            function setZoom(zoom, el) {
                var transformOrigin = [0, 0];
                //el = el || instance.getContainer();
                var p = ['webkit', 'moz', 'ms', 'o'];
                var s = 'scale(' + zoom + ')';
                var oString = (transformOrigin[0] * 100) + '% ' + (transformOrigin[1] * 100) + '%';

                for (var i = 0; i < p.length; i++) {
                    el.style[p[i] + 'Transform'] = s;
                    el.style[p[i] + 'TransformOrigin'] = oString;
                }

                el.style['transform'] = s;
                el.style['transformOrigin'] = oString;
            }

            $scope.changeZoom = function(a) {
                var tooltips = document.querySelectorAll('.tooltip');
                var fontSize = 1;
                var width = 180;
                var height = 140;

                if (($scope.zoom != 7 && a != 1) || ($scope.zoom != 14 && a != -1)) {
                    $scope.zoom += a;
                    var zoomScale = Number($scope.zoom) / 10;
                    setZoom(zoomScale, document.getElementById('belt-grid'));

                    // TODO: Update rulers length instead of zooming everything ( text gets too small)
                    // rulerHorizontal.style.width = `${widthHorizontalRuler * zoomScale}px`;
                    // rulerVertical.style.height = `${widthVerticalRuler * zoomScale}px`;

                    // Keep tooltips with the same size no matter if zoom changes
                    if ($scope.zoom < 10) {
                        tooltips.forEach(tooltip => {
                            tooltip.style.fontSize = `${fontSize / zoomScale}em`;
                            tooltip.style.width = `${width / zoomScale}px`;
                        });
                    }
                }
                //gridData['DemoGrid'].hideInfoCutIfOverflow();
            };

            function isOverflown(element) {
                var zoomScale = Number($scope.zoom) / 10;
                return element.scrollHeight > element.clientHeight * zoomScale || element.scrollWidth > element.clientWidth * zoomScale;
            }

            // $scope.showTooltip = function(el) {
            //     var element = el.currentTarget.childNodes[1];
            //     el.currentTarget.style.zIndex = 2;
            //     if (isOverflown(el.currentTarget)) {
            //         element.style.visibility = "visible";
            //     }
            // }

            // $scope.hideTooltip = function(el) {
            //     var element = el.currentTarget.childNodes[1];
            //     el.currentTarget.style.zIndex = 1;
            //     element.style.visibility = "hidden";
            // }

            $scope.buttonSaveData = function() {
                windowService.runWindowTool($scope, 'cb_ok');
            };

            // $scope.addNewCut = function () {
            //     epModalDialogService.showCustomDialog({
            //         templateOptions: {
            //             templateUrl: 'app/directives/belt-grid/newcut.html'
            //         },
            //         title: 'Enter Cut Size',
            //         status: 'information',
            //         backdrop: true,
            //         buttons: [{
            //             text: 'Save',
            //             type: 'primary',
            //             action:function(){
            //                 var width = parseInt(document.querySelector('.width').value);
            //                 var lengthFT = parseInt(document.querySelector('.lenFT').value);
            //                 var lengthIN = parseInt(document.querySelector('.lenIN').value);
            //
            //                 var totalLength = (lengthFT * 12) + lengthIN
            //                 addWidget(width, length);
            //             }
            //         }, {
            //             text: 'Cancel',
            //             isCancel: true
            //         }],
            //         closeButton: true
            //     });
            // };

            function createCSSFile() {
                var style = document.createElement('style');
                var columns = $scope.beltWidth;

                for (var i = 1; i <= columns; i++) {
                    var widthClass = '#belt-grid .grid-stack > .grid-stack-item[data-gs-width="' + i + '"] { ' +
                            'width: ' + (100 / columns) * i + '%; ' +
                        '}';
                    var xPositionClass = '#belt-grid .grid-stack > .grid-stack-item[data-gs-x="' + i + '"] {' +
                            'left: ' + (100 / columns) * i + '%; ' +
                        '}';
                    var minWidthClass = '#belt-grid .grid-stack > .grid-stack-item[data-gs-min-width="' + i + '"] {' + 
                            'min-width: ' + (100 / columns) * i + '%; ' +
                        '}';
                    var maxWidthClass = '#belt-grid .grid-stack > .grid-stack-item[data-gs-max-width="' + i + '"] {' + 
                            'max-width: ' + (100 / columns) * i + '%; ' +
                        '}';

                    style.innerHTML += widthClass;
                    style.innerHTML += xPositionClass;
                    style.innerHTML += minWidthClass;
                    style.innerHTML += maxWidthClass;
                }
                document.head.appendChild(style);
            }

            var init = function () {
                deserializeData();
                createCSSFile();
                createRulerDimensions();
                createGridStyles();
            };

            init();
        });
    </script>

</body>
</html>